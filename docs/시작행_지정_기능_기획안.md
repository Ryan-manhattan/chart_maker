# 시작 행 지정 기능 기획안

## 1. 기능 개요
- CSV/Excel 파일에서 실제 데이터가 시작되는 행을 사용자가 직접 지정할 수 있는 기능
- 메타데이터, 헤더 정보, 빈 행 등이 포함된 파일을 효율적으로 처리

## 2. 사용자 시나리오
### 2.1 문제 상황
- 파일의 1~6행: 메타데이터 (제목, 작성자, 날짜 등)
- 7행: 실제 컬럼명 (헤더)
- 8행부터: 실제 데이터
- 현재 시스템은 1행을 자동으로 헤더로 인식하여 오류 발생

### 2.2 해결 방안
- 사용자가 파일 업로드 후 데이터 시작 행을 지정
- 지정된 행을 헤더로, 다음 행부터 데이터로 처리

## 3. UI/UX 설계

### 3.1 업로드 프로세스 수정
```
1. 파일 업로드
2. 파일 미리보기 표시 (최대 20행)
   - 행 번호 표시
   - 각 행의 내용 미리보기
3. 시작 행 선택
   - 라디오 버튼 또는 클릭으로 시작 행 선택
   - 선택한 행 하이라이트 표시
4. 확인 및 차트 생성
```

### 3.2 미리보기 화면 구성
```
┌─────────────────────────────────────────────────┐
│ 파일 미리보기                                       │
├─────────────────────────────────────────────────┤
│ O 1행  │ 제목                                    │
│ O 2행  │ 작성자: 홍길동                             │
│ O 3행  │ 작성일: 2025-05-11                        │
│ O 4행  │                                        │
│ O 5행  │ 분석 결과 요약                             │
│ O 6행  │                                        │
│ • 7행  │ Month, Sales, Revenue                  │ <- 선택됨 (헤더)
│   8행  │ January, 100, 10000                    │
│   9행  │ February, 150, 15000                   │
├─────────────────────────────────────────────────┤
│ 시작 행 선택: 7행                                  │
│ [미리보기]  [차트 생성하기]                           │
└─────────────────────────────────────────────────┘
```

### 3.3 추가 기능
1. **자동 감지 모드**
   - 데이터 패턴을 분석하여 시작 행 자동 추천
   - 숫자 비율이 높은 행을 데이터 시작점으로 판단

2. **저장된 설정**
   - 사용자별로 자주 사용하는 파일 형식 저장
   - 다음 업로드 시 자동으로 적용

## 4. 기술 구현

### 4.1 컴포넌트 구조
```
FileUploader
├── FileDropzone (기존)
├── FilePreview (새로 추가)
│   ├── RowSelector
│   └── DataPreview
└── ProcessButton
```

### 4.2 데이터 처리 플로우
```javascript
1. 파일 업로드
   ↓
2. 전체 파일 내용 읽기 (처음 20-30행)
   ↓
3. FilePreview 컴포넌트 표시
   ↓
4. 사용자가 시작 행 선택
   ↓
5. 선택된 행부터 데이터 파싱
   ↓
6. 차트 생성 진행
```

### 4.3 파싱 로직 수정
```javascript
// 현재
Papa.parse(file, {
  header: false,
  ...
})

// 수정 후
Papa.parse(file, {
  header: false,
  skipFirstNLines: startRow - 1,
  ...
})
```

## 5. 개발 우선순위

### 5.1 단계 1 (필수)
- FilePreview 컴포넌트 생성
- 시작 행 선택 기능
- 선택된 행부터 데이터 파싱

### 5.2 단계 2 (확장)
- 자동 감지 기능
- 데이터 타입 미리보기
- 선택 사항 저장 기능

### 5.3 단계 3 (고도화)
- AI 기반 최적 시작 행 추천
- 복잡한 파일 구조 처리
- 다중 헤더 지원

## 6. 예상 이슈 및 해결 방안

### 6.1 성능 이슈
- **문제**: 대용량 파일의 미리보기 로딩
- **해결**: 처음 20-30행만 로딩, 나머지는 lazy loading

### 6.2 다양한 파일 형식
- **문제**: CSV, Excel의 서로 다른 처리 방식
- **해결**: 파일 타입별 공통 인터페이스 정의

### 6.3 사용자 실수
- **문제**: 잘못된 시작 행 선택
- **해결**: 데이터 패턴 분석 후 경고 메시지 표시

## 7. 테스트 계획

### 7.1 단위 테스트
- 다양한 시작 행에 대한 파싱 테스트
- Excel/CSV 파일 형식별 테스트

### 7.2 UI 테스트
- 시작 행 선택 인터랙션 테스트
- 미리보기 화면 렌더링 테스트

### 7.3 통합 테스트
- 전체 업로드 → 차트 생성 플로우 테스트
- 다양한 파일 구조에 대한 테스트

## 8. 향후 확장 방향

### 8.1 고급 설정
- 끝 행 지정 (특정 구간만 추출)
- 특정 컬럼만 선택
- 데이터 필터링 옵션

### 8.2 템플릿 저장
- 사용자별 파일 구조 프리셋 저장
- 팀 내 공유 가능한 템플릿

### 8.3 AI 통합
- 자동 메타데이터 분석
- 데이터 시작 위치 지능형 추천

---

작성일: 2025-05-11
작성자: ChartAI 개발팀
